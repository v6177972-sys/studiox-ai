<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StudioX AI | Monetizza i tuoi Social</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; }
        .glass { background: rgba(18, 18, 22, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); border-radius: 2rem; }
        .nrg-glow { box-shadow: 0 0 20px rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.4); }
        .btn-viral { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .loader { border: 2px solid #222; border-top: 2px solid #6366f1; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        window.FB = { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, getFirestore, doc, setDoc, onSnapshot, updateDoc, increment, arrayUnion };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const APP_ID = "studiox-v6-core";
        const GEMINI_KEY = "AIzaSyA-t4HPU63sjwlxGaHOR3__08cLJRRqyLs";

        function App() {
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState({ nrg: 25, history: [] });
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState("");
            const [toast, setToast] = useState("");

            useEffect(() => {
                // Inserisci qui le tue credenziali Firebase dal pannello Project Settings
                const config = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                if (!config.apiKey) return;

                const app = window.FB.initializeApp(config);
                const auth = window.FB.getAuth(app);
                const db = window.FB.getFirestore(app);

                window.FB.onAuthStateChanged(auth, (u) => {
                    if (u) {
                        setUser(u);
                        const docRef = window.FB.doc(db, 'artifacts', APP_ID, 'users', u.uid, 'profile');
                        window.FB.onSnapshot(docRef, (snap) => {
                            if (snap.exists()) setProfile(snap.data());
                            else window.FB.setDoc(docRef, { nrg: 50, history: [], lastActive: new Date().toISOString() });
                        }, (err) => console.error("Errore Firestore:", err));
                    } else {
                        window.FB.signInAnonymously(auth).catch(e => console.error("Auth Error:", e));
                    }
                });
            }, []);

            const showToast = (m) => { setToast(m); setTimeout(() => setToast(""), 3000); };

            const generate = async () => {
                if (!input.trim()) return showToast("Scrivi un'idea!");
                if (profile.nrg < 5) return showToast("Energia esaurita!");
                
                setLoading(true);
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_KEY}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Agisci come un social media manager. Crea un post virale e 10 hashtag per: ${input}` }] }]
                        })
                    });

                    const data = await res.json();
                    const text = data.candidates[0].content.parts[0].text;
                    setResult(text);

                    const db = window.FB.getFirestore();
                    const docRef = window.FB.doc(db, 'artifacts', APP_ID, 'users', user.uid, 'profile');
                    await window.FB.updateDoc(docRef, {
                        nrg: window.FB.increment(-5),
                        history: window.FB.arrayUnion({ date: new Date().toISOString(), input, text })
                    });
                    showToast("Generato! -5 N-RG");
                } catch (e) {
                    showToast("Errore API Gemini");
                } finally {
                    setLoading(false);
                }
            };

            const refill = async () => {
                if (!user) return;
                const db = window.FB.getFirestore();
                const docRef = window.FB.doc(db, 'artifacts', APP_ID, 'users', user.uid, 'profile');
                await window.FB.updateDoc(docRef, { nrg: window.FB.increment(15) });
                showToast("+15 N-RG! Sponsor caricato.");
            };

            return (
                <div className="min-h-screen max-w-md mx-auto flex flex-col p-6 space-y-6 pb-24 bg-black border-x border-zinc-900">
                    
                    <header className="flex justify-between items-center py-4">
                        <div className="flex flex-col">
                            <h1 className="text-2xl font-black italic tracking-tighter">STUDIOX<span className="text-indigo-500">AI</span></h1>
                            <p className="text-[8px] font-bold text-zinc-600 uppercase tracking-widest">Creator Ecosystem</p>
                        </div>
                        <div className="nrg-glow bg-zinc-900 px-4 py-2 rounded-2xl flex items-center gap-2">
                            <span className="text-yellow-400">‚ö°</span>
                            <span className="text-sm font-black tracking-tighter">{profile.nrg}</span>
                        </div>
                    </header>

                    {/* Monetizzazione: Affiliate Link */}
                    <div className="glass p-4 border-indigo-500/20 bg-indigo-500/5 flex items-center justify-between cursor-pointer group">
                        <div className="flex items-center gap-3">
                            <div className="text-xl">‚ú®</div>
                            <div>
                                <p className="text-[10px] font-black text-indigo-400 uppercase">Offerta Creator</p>
                                <p className="text-[11px] text-zinc-400 font-bold">Inizia con Canva Pro gratis</p>
                            </div>
                        </div>
                        <span className="text-zinc-700 group-hover:text-white">‚Üí</span>
                    </div>

                    {/* Input */}
                    <div className="glass p-6 space-y-4 shadow-2xl">
                        <textarea 
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            placeholder="Cosa vuoi pubblicare oggi?"
                            className="w-full bg-transparent border-none focus:ring-0 text-lg h-32 resize-none text-white placeholder:text-zinc-800"
                        />
                        <button 
                            onClick={generate}
                            disabled={loading}
                            className="w-full btn-viral py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest flex items-center justify-center gap-3 disabled:opacity-50 active:scale-95 transition-all text-white shadow-lg"
                        >
                            {loading ? <div className="loader"></div> : "ü™Ñ"}
                            {loading ? "AI sta scrivendo..." : "Crea Post Virale"}
                        </button>
                    </div>

                    {/* Risultato */}
                    {result && (
                        <div className="glass p-6 border-indigo-500/20 animate-in fade-in slide-in-from-bottom-4">
                            <div className="flex justify-between items-center mb-4 border-b border-zinc-800 pb-2">
                                <span className="text-[8px] font-black text-indigo-400 uppercase tracking-widest">Contenuto Generato</span>
                                <button onClick={() => {navigator.clipboard.writeText(result); showToast("Copiato!");}} className="text-[10px] text-zinc-500 font-bold uppercase">Copia</button>
                            </div>
                            <div className="text-sm text-zinc-300 leading-relaxed whitespace-pre-wrap italic">
                                {result}
                            </div>
                        </div>
                    )}

                    {/* Monetizzazione: Reward Ad */}
                    <div onClick={refill} className="glass p-5 flex items-center justify-between cursor-pointer border-green-500/20 hover:bg-zinc-900 transition-all">
                        <div className="flex items-center gap-4">
                            <div className="text-2xl">üéÅ</div>
                            <div>
                                <p className="text-[10px] font-black text-white uppercase tracking-wider">Bonus Energia</p>
                                <p className="text-[9px] text-zinc-500 font-bold italic">Guarda uno sponsor per +15 N-RG</p>
                            </div>
                        </div>
                        <span className="text-green-500 font-black text-xs">+15</span>
                    </div>

                    {/* AdSpace Placeholder per Google AdSense */}
                    <div className="w-full h-24 bg-zinc-900/40 rounded-[2.5rem] border border-dashed border-zinc-800 flex items-center justify-center overflow-hidden">
                        <p className="text-[8px] font-bold text-zinc-800 uppercase tracking-[0.6em] text-center">Pubblicit√† / Ads</p>
                    </div>

                    {/* Toast Overlay */}
                    {toast && (
                        <div className="fixed bottom-10 left-1/2 -translate-x-1/2 bg-white text-black px-8 py-3 rounded-full shadow-2xl z-[100] text-[9px] font-black uppercase tracking-widest animate-bounce">
                            {toast}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

